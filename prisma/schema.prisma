-- SQL SchemaforAinaWebApp
--Database: PostgreSQL

-- 1. Users Table: Stores user account information.
CREATE TABLE "Users" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "name" VARCHAR(255),
    "email" VARCHAR(255) UNIQUE NOT NULL,
    "password" VARCHAR(255), -- For credential-based login
    "image" TEXT,
    "emailVerified" TIMESTAMPTZ,
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 2. Categories Table: Stores main product categories (e.g., Men, Women).
CREATE TABLE "Categories" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "name" VARCHAR(255) UNIQUE NOT NULL,
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Child table for Categories (e.g., T-shirts, Hoodies).
CREATE TABLE "SubCategories" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "name" VARCHAR(255) NOT NULL,
    "categoryId" UUID NOT NULL REFERENCES "Categories"("id") ON DELETE CASCADE,
    UNIQUE("name", "categoryId")
);

-- 3. Products Table: Stores all product information.
CREATE TABLE "Products" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "name" VARCHAR(255) NOT NULL,
    "description" TEXT,
    "mrp" NUMERIC(10, 2) NOT NULL,
    "price" NUMERIC(10, 2) NOT NULL,
    "images" TEXT[], -- Array of image URLs
    "inStock" BOOLEAN NOT NULL DEFAULT TRUE,
    "subCategoryId" UUID NOT NULL REFERENCES "SubCategories"("id"),
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 4. ThemeSections Table: For homepage themed sections like 'Anime', 'Cars'.
CREATE TABLE "ThemeSections" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "name" VARCHAR(255) UNIQUE NOT NULL,
    "title" VARCHAR(255),
    "description" TEXT,
    "imageUrl" TEXT,
    "isActive" BOOLEAN NOT NULL DEFAULT TRUE
);

-- Mapping table to link themes to sub-categories.
CREATE TABLE "ThemeSectionCategories" (
    "themeSectionId" UUID NOT NULL REFERENCES "ThemeSections"("id") ON DELETE CASCADE,
    "subCategoryId" UUID NOT NULL REFERENCES "SubCategories"("id") ON DELETE CASCADE,
    PRIMARY KEY ("themeSectionId", "subCategoryId")
);

-- 5. Ratings Table: Stores user reviews and ratings for products.
CREATE TABLE "Ratings" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "userId" UUID NOT NULL REFERENCES "Users"("id") ON DELETE CASCADE,
    "productId" UUID NOT NULL REFERENCES "Products"("id") ON DELETE CASCADE,
    "rating" INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
    "reviewText" TEXT,
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UNIQUE("userId", "productId") -- A user can review a product only once.
);

-- 6. Specs Table: For product specifications (e.g., Material: Cotton).
CREATE TABLE "Specs" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "productId" UUID NOT NULL REFERENCES "Products"("id") ON DELETE CASCADE,
    "key" VARCHAR(255) NOT NULL,
    "value" VARCHAR(255) NOT NULL
);

-- 7. Address Table: Stores shipping addresses for users.
CREATE TABLE "Address" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "userId" UUID NOT NULL REFERENCES "Users"("id") ON DELETE CASCADE,
    "name" VARCHAR(255) NOT NULL,
    "street" TEXT NOT NULL,
    "city" VARCHAR(255) NOT NULL,
    "state" VARCHAR(255) NOT NULL,
    "zipCode" VARCHAR(20) NOT NULL,
    "country" VARCHAR(255) NOT NULL,
    "phone" VARCHAR(50)
);

-- 8. Coupon Table: Stores discount coupons.
CREATE TABLE "Coupon" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "code" VARCHAR(255) UNIQUE NOT NULL,
    "discount" NUMERIC(5, 2) NOT NULL,
    "isActive" BOOLEAN NOT NULL DEFAULT TRUE,
    "expiresAt" TIMESTAMPTZ
);

-- 9. Orders Table: Header information for a customer's order.
CREATE TABLE "Orders" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "userId" UUID NOT NULL REFERENCES "Users"("id") ON DELETE CASCADE,
    "addressId" UUID NOT NULL REFERENCES "Address"("id"),
    "total" NUMERIC(10, 2) NOT NULL,
    "status" VARCHAR(50) NOT NULL DEFAULT 'PENDING',
    "isPaid" BOOLEAN NOT NULL DEFAULT FALSE,
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 10. OrderItems Table: Line items for each order.
CREATE TABLE "OrderItems" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "orderId" UUID NOT NULL REFERENCES "Orders"("id") ON DELETE CASCADE,
    "productId" UUID NOT NULL REFERENCES "Products"("id"),
    "quantity" INTEGER NOT NULL,
    "priceAtPurchase" NUMERIC(10, 2) NOT NULL -- Price of the product when the order was placed.
);

-- 11. Cart Table: The container for a user's cart.
CREATE TABLE "Cart" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "userId" UUID UNIQUE NOT NULL REFERENCES "Users"("id") ON DELETE CASCADE,
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    "updatedAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 12. CartItems Table: The actual items within a user's cart.
CREATE TABLE "CartItems" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "cartId" UUID NOT NULL REFERENCES "Cart"("id") ON DELETE CASCADE,
    "productId" UUID NOT NULL REFERENCES "Products"("id"),
    "quantity" INTEGER NOT NULL,
    "color" VARCHAR(100),
    "size" VARCHAR(100),
    UNIQUE("cartId", "productId", "color", "size")
);

-- 13. Wishlist Table: The container for a user's wishlist.
CREATE TABLE "Wishlist" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "userId" UUID UNIQUE NOT NULL REFERENCES "Users"("id") ON DELETE CASCADE
);

-- 14. WishlistItems Table: The actual items within a user's wishlist.
CREATE TABLE "WishlistItems" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "wishlistId" UUID NOT NULL REFERENCES "Wishlist"("id") ON DELETE CASCADE,
    "productId" UUID NOT NULL REFERENCES "Products"("id"),
    UNIQUE("wishlistId", "productId")
);

-- 15. Feedback Table: Stores general user feedback about the website.
CREATE TABLE "Feedback" (
    "id" UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    "userId" UUID REFERENCES "Users"("id") ON DELETE SET NULL, -- Optional: link to a user
    "subject" VARCHAR(255),
    "message" TEXT NOT NULL,
    "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);